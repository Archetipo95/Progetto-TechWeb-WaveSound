<!DOCTYPE html>
<html lang="en">

<head>

	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>WaveSound | Main Page</title>

	<!-- font + fav icon -->
	<link rel="icon" type="image/png" href="misc/img/logo.png">
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">

	<!-- style -->
	<link rel="stylesheet" type="text/css" href="misc/css/style.css" />

</head>

<body>


	<header>
		<?php
			include("misc/include/header.html");
			$_SESSION["current-page"]="Home";
		?>
	</header>

	<nav>
		<?php
			include("misc/include/navigation.html");
		?>
	</nav>

	<main class="main-right center">
		<div class="content-body">
			<div class="content">
				<h1 class="center">Music in Evidence</h1>

				<!--include trneding-->

				<?php
					require('misc/php/tools.php');
					$query = select("SELECT likes.id_song as canzone,title,genre.name,username,SUM(CASE WHEN score > 0 THEN 1 ELSE 0 END) AS somma,album.picture FROM likes,song,library,user,album,genre WHERE likes.id_song=song.id_song AND library.id_song=song.id_song AND song.id_album=album.id_album AND library.id_user=user.u_id AND song.genre=genre.id_genre GROUP BY likes.id_song ORDER BY somma DESC LIMIT 5");

					if(count($query)>0){
						echo '<h2 class="content-title">Trending</h2>';
						echo '<div class="center">';
						echo '<div class="results-container">';
						for ($i = 0;$i < count($query);$i++) {
							$song = $query[$i][0];
							$title = $query[$i][1];
							$genre = $query[$i][2];
							$username = $query[$i][3];
							$score = $query[$i][4];
							$pathPicture = $query[$i][5];

							echo '<a href="listen.html?id_song=' . $song . '">';
							echo '<div class="result-card">';

							echo '<img src="misc/img/album-covers/' . $pathPicture . '" />';
							echo '<div class="result-card-title">'.$title.'</div>';
							echo '<div class="result-card-title-sub">'.$genre.'</div>';
							echo '<div class="result-card-title-sub">'.$username.'</div>';
							echo '<div class="result-card-title-sub">'.$score.' likes</div>';

							echo '</a>';
							echo '</div>';
						}
						echo '<div class="spacer" style="clear: both;"></div></div>';
						echo '</div>';
					}

					$query2 = select("SELECT likes.id_song as canzone,title,genre.name,username,SUM(CASE WHEN score > 0 THEN 1 ELSE 0 END) AS somma,album.picture FROM likes,song,library,user,album,genre WHERE likes.id_song=song.id_song AND library.id_song=song.id_song AND song.id_album=album.id_album AND library.id_user=user.u_id AND song.genre=genre.id_genre GROUP BY genre.name ORDER BY somma DESC LIMIT 5");

					if(count($query2)>0){
						echo '<h2 class="content-title">Hot Music in Top Genres</h2>';
						echo '<div class="center">';
						echo '<div class="results-container">';
						for ($i = 0;$i < count($query2);$i++) {
							$song = $query2[$i][0];
							$title = $query2[$i][1];
							$genre = $query2[$i][2];
							$username = $query2[$i][3];
							$score = $query2[$i][4];
							$pathPicture = $query2[$i][5];

							echo '<a href="listen.html?id_song=' . $song . '">';
							echo '<div class="result-card">';

							echo '<img src="misc/img/album-covers/' . $pathPicture . '" />';
							echo '<div class="result-card-title">'.$title.'</div>';
							echo '<div class="result-card-title-sub">'.$genre.'</div>';
							echo '<div class="result-card-title-sub">'.$username.'</div>';
							echo '<div class="result-card-title-sub">'.$score.' likes</div>';

							echo '</a>';
							echo '</div>';
						}
						echo '<div class="spacer" style="clear: both;"></div></div>';
						echo '</div>';
					}

					$query3 = select("SELECT likes.id_song as canzone,title,genre.name,username,SUM(CASE WHEN score > 0 THEN 1 ELSE 0 END) AS somma,album.picture FROM likes,song,library,user,album,genre WHERE likes.id_song=song.id_song AND library.id_song=song.id_song AND song.id_album=album.id_album AND library.id_user=user.u_id AND song.genre=genre.id_genre GROUP BY likes.id_song ORDER BY upload_date DESC LIMIT 5");

					if(count($query3)>0){
						echo '<h2 class="content-title">New Music</h2>';
						echo '<div class="center">';
						echo '<div class="results-container">';
						for ($i = 0;$i < count($query3);$i++) {
							$song = $query3[$i][0];
							$title = $query3[$i][1];
							$genre = $query3[$i][2];
							$username = $query3[$i][3];
							$score = $query3[$i][4];
							$pathPicture = $query3[$i][5];

							echo '<a href="listen.html?id_song=' . $song . '">';
							echo '<div class="result-card">';

							echo '<img src="misc/img/album-covers/' . $pathPicture . '" />';
							echo '<div class="result-card-title">'.$title.'</div>';
							echo '<div class="result-card-title-sub">'.$genre.'</div>';
							echo '<div class="result-card-title-sub">'.$username.'</div>';
							echo '<div class="result-card-title-sub">'.$score.' likes</div>';

							echo '</a>';
							echo '</div>';
						}
						echo '<div class="spacer" style="clear: both;"></div></div>';
						echo '</div>';
					}
				?>
			</div>
		</div>
	</main>

	<footer class="footer-main">
		<?php
			include("misc/include/footer.html");
		?>
	</footer>

	<button onclick="topFunction()" id="button-top" title="Go to top">Top</button>

	<script src="misc/js/button-top.js"></script>

</body>

</html>
